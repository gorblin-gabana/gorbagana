# agave-accounts-hash-cache-tool

## Overview

This tool provides command-line utilities for inspecting, searching, and diffing Solana accounts hash cache files and directories. It is primarily used for debugging, validating, and analyzing the intermediate hash cache files generated by the Solana validator's accounts database during hash calculation and snapshotting.

## Structure

```
accounts-hash-cache-tool/
├── Cargo.toml         # Crate manifest and dependencies
└── src/
    └── main.rs        # Main binary: CLI logic, subcommands, and all tool functionality
```

## What This Tool Does
- Inspect individual accounts hash cache files (view account pubkeys, hashes, balances)
- Search for specific pubkeys across cache files in a directory
- Diff two cache files or directories to find mismatches
- Analyze the final state of two cache directories (for debugging validator state)
- Supports binning and range selection for large datasets

## Where This Tool Is Imported
- **Standalone binary:** This tool is not imported as a library. It is invoked directly as a CLI utility for Solana node operators and developers.
- **Related tools:** Used alongside `accounts-db`, `store-tool`, and `store-histogram` for storage and hash debugging.

## What This Tool Imports
- **Solana crates:**
  - `solana-accounts-db` (core account storage and hash logic)
  - `solana-pubkey` (public key types)
  - `solana-version` (versioning)
  - `solana-clap-utils` (CLI helpers)
- **External crates:**
  - `clap` (argument parsing)
  - `ahash`, `anyhow`, `bytemuck`, `memmap2`, `rayon` (performance, error handling, memory mapping, parallelism)
  - `std` (filesystem, I/O, concurrency)

## Example Usage

- Inspect a cache file:
  ```sh
  agave-accounts-hash-cache-tool inspect /path/to/cache_file
  ```
- Search for pubkeys in a directory:
  ```sh
  agave-accounts-hash-cache-tool search /path/to/cache_dir PUBKEY1,PUBKEY2
  ```
- Diff two cache files:
  ```sh
  agave-accounts-hash-cache-tool diff files /path/to/file1 /path/to/file2
  ```
- Diff two cache directories:
  ```sh
  agave-accounts-hash-cache-tool diff directories /path/to/dir1 /path/to/dir2
  ```

## Integration Points
- Used by Solana node operators, core developers, and test engineers for:
  - Debugging validator state mismatches
  - Validating snapshot and hash cache correctness
  - Analyzing account state transitions

## Related Folders
- `accounts-db/` (core database and hash cache file generation)
- `accounts-db/store-tool/` (storage inspection)
- `accounts-db/store-histogram/` (storage profiling)

---

For more details, see the CLI help:
```sh
agave-accounts-hash-cache-tool --help
``` 